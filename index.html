<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeCamp Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h1 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            color: #6b7280;
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 500;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.2s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .question-counter {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .question-text {
            color: #1f2937;
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.5;
            font-weight: 500;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            padding: 14px 18px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            text-align: left;
        }
        
        .option:hover {
            border-color: #667eea;
            background: #f9fafb;
        }
        
        .option.selected {
            border-color: #667eea;
            background: #eef2ff;
        }
        
        .result-screen {
            text-align: center;
        }
        
        .score-display {
            font-size: 4em;
            font-weight: 700;
            margin: 20px 0;
        }
        
        .tier-badge {
            display: inline-block;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.8em;
            font-weight: 700;
            color: white;
            margin: 20px 0;
        }
        
        .tier-t1 {
            background: #EAB308; /* Galben - 1/3 */
        }
        
        .tier-t2 {
            background: #EA580C; /* Portocaliu - 2/3 */
        }
        
        .tier-t3 {
            background: #16A34A; /* Verde - 3/3 */
        }
        
        .tier-message {
            font-size: 1.2em;
            color: #374151;
            margin: 20px 0;
            line-height: 1.6;
        }
        
        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .info-message {
            background: #dbeafe;
            color: #1e40af;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .already-played {
            text-align: center;
            padding: 40px 20px;
        }
        
        .already-played h2 {
            color: #1f2937;
            margin-bottom: 15px;
        }
        
        .already-played p {
            color: #6b7280;
            line-height: 1.6;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 25px;
            }
            
            h1 {
                font-size: 1.6em;
            }
            
            .score-display {
                font-size: 3em;
            }
            
            .tier-badge {
                font-size: 1.4em;
                padding: 12px 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Start Screen -->
        <div id="startScreen" class="screen active">
            <h1>üöÄ CodeCamp Quiz</h1>
            <p class="subtitle">TesteazƒÉ-»õi cuno»ôtin»õele de programare √Æn 3 √ÆntrebƒÉri!</p>
            
            <div class="input-group" id="tokenInputGroup" style="display: none;">
                <label for="tokenInput">Token (op»õional):</label>
                <input type="text" id="tokenInput" placeholder="Introdu token-ul tƒÉu unic">
                <div class="info-message" style="margin-top: 10px;">
                    DacƒÉ ai primit un token, introdu-l mai sus. Altfel, po»õi continua fƒÉrƒÉ token.
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="startQuiz()">√éncepe Quiz-ul</button>
        </div>
        
        <!-- Quiz Screen -->
        <div id="quizScreen" class="screen">
            <div class="question-counter" id="questionCounter"></div>
            <div class="question-text" id="questionText"></div>
            <div class="options" id="optionsContainer"></div>
            <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>UrmƒÉtoarea</button>
        </div>
        
        <!-- Result Screen -->
        <div id="resultScreen" class="screen">
            <div class="result-screen">
                <h1>Rezultatul tƒÉu</h1>
                <div class="score-display" id="scoreDisplay"></div>
                <div id="tierBadge"></div>
                <div class="tier-message" id="tierMessage"></div>
                
                <!-- Sec»õiune revendicare (pentru scor > 0) -->
                <div id="claimPrizeSection" style="margin-top: 30px; padding: 20px; background: #FEF3C7; border-radius: 12px; border: 2px solid #F59E0B;">
                    <p style="color: #92400E; font-weight: 600; margin-bottom: 15px; font-size: 1.1em;">
                        ‚ö†Ô∏è Aten»õie! Acest buton trebuie apƒÉsat √Æn prezen»õa personalului de la stand pentru a confirma revendicarea premiului.
                    </p>
                    <button class="btn btn-primary" onclick="claimPrize()" style="font-size: 1.2em; padding: 15px 40px; width: 100%;">
                        üéÅ RevendicƒÉ Premiul
                    </button>
                </div>
                
                <!-- Sec»õiune reluare (pentru scor = 0) -->
                <div id="retrySection" style="display: none; margin-top: 30px; padding: 20px; background: #FEE2E2; border-radius: 12px; border: 2px solid #EF4444;">
                    <p style="color: #991B1B; font-weight: 600; margin-bottom: 15px; font-size: 1.1em;">
                        Din pƒÉcate nu ai rƒÉspuns corect la nicio √Æntrebare. Po»õi √Æncerca din nou!
                    </p>
                    <button class="btn" onclick="retryQuiz()" style="font-size: 1.2em; padding: 15px 40px; width: 100%; background: #EF4444; color: white;">
                        üîÑ √éncearcƒÉ din nou
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Already Played Screen -->
        <div id="alreadyPlayedScreen" class="screen">
            <div class="already-played">
                <h2>‚úÖ Ai participat deja!</h2>
                <p>Mul»õumim pentru participare! Po»õi juca o singurƒÉ datƒÉ pentru a men»õine competi»õia corectƒÉ.</p>
                
                <div id="previousResultContainer" style="margin: 30px 0;">
                    <h3 style="color: #374151; margin-bottom: 15px;">Rezultatul tƒÉu anterior:</h3>
                    <div class="score-display" id="previousScore" style="font-size: 3em;"></div>
                    <div id="previousTierBadge"></div>
                    <div class="tier-message" id="previousTierMessage" style="font-size: 1.1em;"></div>
                </div>
                
                <p style="margin-top: 20px; font-weight: 600; color: #1f2937;">ViziteazƒÉ standul pentru a-»õi ridica premiul!</p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURARE
        // ============================================
        
        const CONFIG = {
            BACKEND_URL: null,
            NUM_QUESTIONS: 3,
            LOCAL_STORAGE_KEY: 'cc_quiz_played',
            SCORE_STORAGE_KEY: 'cc_quiz_score',
            TIER_STORAGE_KEY: 'cc_quiz_tier',
            IN_PROGRESS_KEY: 'cc_quiz_in_progress',
            USE_TOKENS: false
        };
        
        // ============================================
        // QUESTION BANK (30+ √ÆntrebƒÉri)
        // ============================================
        
        const questionBank = (() => {
            // √éntrebƒÉri encodate pentru anti-cheat
            const e = "W3sicSI6ICJDZSByZXR1cm5lYXrEgyBgdHlwZW9mIG51bGxgIMOubiBKYXZhU2NyaXB0PyIsICJvcHRpb25zIjogWyInbnVsbCciLCAiJ3VuZGVmaW5lZCciLCAiJ29iamVjdCciLCAiJ251bWJlciciXSwgImMiOiAyfSwgeyJxIjogIkNlIGFmaciZZWF6xIMgYGNvbnNvbGUubG9nKDAuMSArIDAuMiA9PT0gMC4zKWAgw65uIEphdmFTY3JpcHQ/IiwgIm9wdGlvbnMiOiBbInRydWUiLCAiZmFsc2UiLCAidW5kZWZpbmVkIiwgIk5hTiJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgZmFjZSBgQXJyYXkucHJvdG90eXBlLm1hcCgpYCDDrm4gSmF2YVNjcmlwdD8iLCAib3B0aW9ucyI6IFsiTW9kaWZpY8SDIGFycmF5LXVsIG9yaWdpbmFsIiwgIkNyZWVhesSDIHVuIGFycmF5IG5vdSBjdSByZXp1bHRhdGVsZSBmdW5jyJtpZWkiLCAiRmlsdHJlYXrEgyBlbGVtZW50ZWxlIiwgIlNvcnRlYXrEgyBhcnJheS11bCJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgdGlwIGRlIHZhcmlhYmlsxIMgTlUgcG9hdGUgZmkgcmVhc2lnbmF0xIMgw65uIEphdmFTY3JpcHQ/IiwgIm9wdGlvbnMiOiBbInZhciIsICJsZXQiLCAiY29uc3QiLCAiZnVuY3Rpb24iXSwgImMiOiAyfSwgeyJxIjogIkNlIGFmaciZZWF6xIMgYGNvbnNvbGUubG9nKDEgKyAnMScpYCDDrm4gSmF2YVNjcmlwdD8iLCAib3B0aW9ucyI6IFsiMiIsICInMTEnIiwgIjExIiwgInVuZGVmaW5lZCJdLCAiYyI6IDF9LCB7InEiOiAiQ2FyZSBlIGRpZmVyZW7Im2EgcHJpbmNpcGFsxIMgw65udHJlIGA9PWAgyJlpIGA9PT1gIMOubiBKYXZhU2NyaXB0PyIsICJvcHRpb25zIjogWyJOdSBlIGRpZmVyZW7Im8SDIiwgImA9PT1gIHZlcmlmaWPEgyDImWkgdGlwdWwgZGUgZGF0ZSIsICJgPT1gIGUgbWFpIHJhcGlkIiwgImA9PT1gIGZ1bmPIm2lvbmVhesSDIGRvYXIgY3UgbnVtZXJlIl0sICJjIjogMX0sIHsicSI6ICJDZSBmYWNlIGBhc3luYy9hd2FpdGAgw65uIEphdmFTY3JpcHQ/IiwgIm9wdGlvbnMiOiBbIkNyZWVhesSDIHRocmVhZC11cmkgbm9pIiwgIlNpbXBsaWZpY8SDIGx1Y3J1bCBjdSBQcm9taXNlLXVyaSIsICJPcHJlyJl0ZSBleGVjdcibaWEgcHJvZ3JhbXVsdWkiLCAiQ3JlZWF6xIMgdmFyaWFiaWxlIGFzaW5jcm9uZSJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgcmV0dXJuZWF6xIMgYFsxLCAyLCAzXS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKWAgw65uIEphdmFTY3JpcHQ/IiwgIm9wdGlvbnMiOiBbIjAiLCAiNiIsICJbMSwyLDNdIiwgInVuZGVmaW5lZCJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgZmFjZSBgZXZlbnQucHJldmVudERlZmF1bHQoKWAgw65uIEphdmFTY3JpcHQ/IiwgIm9wdGlvbnMiOiBbIsiYdGVyZ2UgZXZlbnQtdWwiLCAiT3ByZciZdGUgY29tcG9ydGFtZW50dWwgZGVmYXVsdCBhbCBicm93c2VydWx1aSIsICJDcmVlYXrEgyB1biBldmVudCBub3UiLCAiT3ByZciZdGUgcHJvcGFnYXJlYSJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgZSBvIGNsb3N1cmUgw65uIEphdmFTY3JpcHQ/IiwgIm9wdGlvbnMiOiBbIk8gZnVuY8ibaWUgw65uY2hpc8SDIiwgIk8gZnVuY8ibaWUgY2FyZSByZcibaW5lIHNjb3BlLXVsIMOubiBjYXJlIGEgZm9zdCBjcmVhdMSDIiwgIk8gdmFyaWFiaWzEgyBjb25zdGFudMSDIiwgIk8gY2xhc8SDIHByaXZhdMSDIl0sICJjIjogMX0sIHsicSI6ICJDZSByZXR1cm5lYXrEgyBgISEwYCDDrm4gSmF2YVNjcmlwdD8iLCAib3B0aW9ucyI6IFsidHJ1ZSIsICJmYWxzZSIsICIwIiwgInVuZGVmaW5lZCJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgZmFjZSBgSlNPTi5wYXJzZSgpYCDDrm4gSmF2YVNjcmlwdD8iLCAib3B0aW9ucyI6IFsiQ29udmVydGXImXRlIHVuIG9iaWVjdCDDrm4gc3RyaW5nIiwgIkNvbnZlcnRlyJl0ZSB1biBzdHJpbmcgSlNPTiDDrm4gb2JpZWN0IiwgIlZhbGlkZWF6xIMgSlNPTiIsICJDb21wcmltxIMgSlNPTiJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgbW9kaWZpY2F0b3IgZmFjZSBvIHZhcmlhYmlsxIMgY29uc3RhbnTEgyDDrm4gSmF2YT8iLCAib3B0aW9ucyI6IFsiY29uc3QiLCAiZmluYWwiLCAic3RhdGljIiwgInJlYWRvbmx5Il0sICJjIjogMX0sIHsicSI6ICJDZSBlIG8gaW50ZXJmYcibxIMgw65uIEphdmE/IiwgIm9wdGlvbnMiOiBbIk8gY2xhc8SDIGFic3RyYWN0xIMiLCAiVW4gY29udHJhY3QgY3UgbWV0b2RlIG5laW1wbGVtZW50YXRlIiwgIlVuIHRpcCBkZSBhcnJheSIsICJPIGZ1bmPIm2llIHN0YXRpY8SDIl0sICJjIjogMX0sIHsicSI6ICJDZSBmYWNlIGtleXdvcmQtdWwgYHN0YXRpY2Agw65uIEphdmE/IiwgIm9wdGlvbnMiOiBbIkZhY2UgY2xhc2EgZmluYWzEgyIsICJGYWNlIG1lbWJydWwgc8SDIGFwYXLIm2luxIMgY2xhc2VpLCBudSBpbnN0YW7Im2VpIiwgIk9wcmXImXRlIG1vyJl0ZW5pcmVhIiwgIkZhY2UgbWV0b2RhIHByaXZhdMSDIl0sICJjIjogMX0sIHsicSI6ICJDZSB0aXAgcmV0dXJuZWF6xIMgYHZvaWRgIMOubiBKYXZhPyIsICJvcHRpb25zIjogWyJudWxsIiwgIjAiLCAiZmFsc2UiLCAiTmltaWMgKG5pY2l1biB0aXApIl0sICJjIjogM30sIHsicSI6ICJDZSBmYWNlIGBBcnJheUxpc3RgIMOubiBKYXZhPyIsICJvcHRpb25zIjogWyJDcmVlYXrEgyB1biBhcnJheSBmaXgiLCAiQ3JlZWF6xIMgbyBsaXN0xIMgZGluYW1pY8SDIiwgIlNvcnRlYXrEgyB1biBhcnJheSIsICJDcmVlYXrEgyB1biBoYXNobWFwIl0sICJjIjogMX0sIHsicSI6ICJDZSBlIHBvbGltb3JmaXNtdWwgw65uIEphdmE/IiwgIm9wdGlvbnMiOiBbIk1vyJl0ZW5pcmUgbXVsdGlwbMSDIiwgIk1haSBtdWx0ZSBmb3JtZSBhbGUgYWNlbHVpYciZaSBsdWNydSIsICJPIGludGVyZmHIm8SDIiwgIk8gY2xhc8SDIGFic3RyYWN0xIMiXSwgImMiOiAxfSwgeyJxIjogIkNlIGZhY2UgYHRyeS1jYXRjaGAgw65uIEphdmE/IiwgIm9wdGlvbnMiOiBbIk9wdGltaXplYXrEgyBjb2R1bCIsICJHZXN0aW9uZWF6xIMgZXhjZXDIm2lpbGUiLCAiQ3JlZWF6xIMgdGhyZWFkLXVyaSIsICJWYWxpZGVhesSDIGlucHV0LXVsIl0sICJjIjogMX0sIHsicSI6ICJDYXJlIGUgZGlmZXJlbsibYSDDrm50cmUgYD09YCDImWkgYC5lcXVhbHMoKWAgw65uIEphdmEgcGVudHJ1IFN0cmluZy11cmk/IiwgIm9wdGlvbnMiOiBbIk51IGUgZGlmZXJlbsibxIMiLCAiYD09YCBjb21wYXLEgyByZWZlcmluyJtlbGUsIGAuZXF1YWxzKClgIGNvbXBhcsSDIGNvbsibaW51dHVsIiwgImBlcXVhbHMoKWAgZSBtYWkgcmFwaWQiLCAiYD09YCBlIGRlcHJlY2F0ZWQiXSwgImMiOiAxfSwgeyJxIjogIkNlIGZhY2UgYGxpc3QuYXBwZW5kKClgIMOubiBQeXRob24/IiwgIm9wdGlvbnMiOiBbIsiYdGVyZ2UgdWx0aW11bCBlbGVtZW50IiwgIkFkYXVnxIMgdW4gZWxlbWVudCBsYSBmaW5hbCIsICJTb3J0ZWF6xIMgbGlzdGEiLCAiQ3JlZWF6xIMgbyBjb3BpZSJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgcmV0dXJuZWF6xIMgYGxlbihbMSwgMiwgM10pYCDDrm4gUHl0aG9uPyIsICJvcHRpb25zIjogWyIxIiwgIjIiLCAiMyIsICI2Il0sICJjIjogMn0sIHsicSI6ICJDZSBmYWNlIGByYW5nZSg1KWAgw65uIFB5dGhvbj8iLCAib3B0aW9ucyI6IFsiQ3JlZWF6xIMgWzAsMSwyLDMsNF0iLCAiQ3JlZWF6xIMgWzEsMiwzLDQsNV0iLCAiQ3JlZWF6xIMgNSIsICJDcmVlYXrEgyB1biBzdHJpbmciXSwgImMiOiAwfSwgeyJxIjogIkNlIGUgdW4gZGVjb3JhdG9yIMOubiBQeXRob24/IiwgIm9wdGlvbnMiOiBbIk8gY2xhc8SDIiwgIk8gZnVuY8ibaWUgY2FyZSBtb2RpZmljxIMgbyBhbHTEgyBmdW5jyJtpZSIsICJVbiBjb21lbnRhcml1IiwgIk8gdmFyaWFiaWzEgyBnbG9iYWzEgyJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgZmFjZSBgZGljdC5nZXQoJ2tleScpYCDDrm4gUHl0aG9uPyIsICJvcHRpb25zIjogWyJBcnVuY8SDIGVyb2FyZSBkYWPEgyBudSBleGlzdMSDIiwgIlJldHVybmVhesSDIHZhbG9hcmVhIHNhdSBOb25lIiwgIsiYdGVyZ2UgY2hlaWEiLCAiTW9kaWZpY8SDIGRpY8ibaW9uYXJ1bCJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgdGlwIGUgYFRydWVgIMOubiBQeXRob24/IiwgIm9wdGlvbnMiOiBbImludCIsICJzdHIiLCAiYm9vbCIsICJmbG9hdCJdLCAiYyI6IDJ9LCB7InEiOiAiQ2UgZmFjZSBgU0VMRUNUIERJU1RJTkNUYCDDrm4gU1FMPyIsICJvcHRpb25zIjogWyJTZWxlY3RlYXrEgyB0b2F0ZSByw6JuZHVyaWxlIiwgIlNlbGVjdGVhesSDIGRvYXIgcsOibmR1cmkgdW5pY2UiLCAiU29ydGVhesSDIHJlenVsdGF0ZWxlIiwgIsiYdGVyZ2UgZHVwbGljYXRlIGRpbiB0YWJlbCJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgdGlwIGRlIEpPSU4gcmV0dXJuZWF6xIMgZG9hciByw6JuZHVyaWxlIGNvbXVuZSDDrm4gYW1iZWxlIHRhYmVsZT8iLCAib3B0aW9ucyI6IFsiTEVGVCBKT0lOIiwgIlJJR0hUIEpPSU4iLCAiSU5ORVIgSk9JTiIsICJPVVRFUiBKT0lOIl0sICJjIjogMn0sIHsicSI6ICJDZSBmYWNlIGNvbWFuZGEgYERFTEVURSBGUk9NIHVzZXJzIFdIRVJFIGlkPTVgIMOubiBTUUw/IiwgIm9wdGlvbnMiOiBbIsiYdGVyZ2UgdG9hdGUgcsOibmR1cmlsZSIsICLImHRlcmdlIHVzZXJ1bCBjdSBpZD01IiwgIkFjdHVhbGl6ZWF6xIMgdXNlcnVsIiwgIlNlbGVjdGVhesSDIHVzZXJ1bCJdLCAiYyI6IDF9LCB7InEiOiAiQ2UgZmFjZSBgQ09VTlQoKilgIMOubiBTUUw/IiwgIm9wdGlvbnMiOiBbIsOObm11bMibZciZdGUgdmFsb3JpbGUiLCAiTnVtxINyxIMgcsOibmR1cmlsZSIsICJDYWxjdWxlYXrEgyBtZWRpYSIsICJTb3J0ZWF6xIMgZGF0ZWxlIl0sICJjIjogMX0sIHsicSI6ICJDZSBpbmRleCDDrm1idW7Eg3TEg8ibZciZdGUgcGVyZm9ybWFuyJthIHF1ZXJ5LXVyaWxvciBTUUw/IiwgIm9wdGlvbnMiOiBbIlBSSU1BUlkgS0VZIiwgIklOREVYIiwgIlVOSVFVRSIsICJUb2F0ZSB2YXJpYW50ZWxlIl0sICJjIjogM30sIHsicSI6ICJDZSBjb21wbGV4aXRhdGUgYXJlIGPEg3V0YXJlYSDDrm50ci11biBhcnJheSBuZXNvcnRhdD8iLCAib3B0aW9ucyI6IFsiTygxKSIsICJPKGxvZyBuKSIsICJPKG4pIiwgIk8obsKyKSJdLCAiYyI6IDJ9LCB7InEiOiAiQ2Ugc3RydWN0dXLEgyBkZSBkYXRlIGZvbG9zZciZdGUgcHJpbmNpcGl1bCBMSUZPPyIsICJvcHRpb25zIjogWyJRdWV1ZSIsICJTdGFjayIsICJBcnJheSIsICJUcmVlIl0sICJjIjogMX0sIHsicSI6ICJDZSBjb2QgSFRUUCDDrm5zZWFtbsSDICdOb3QgRm91bmQnPyIsICJvcHRpb25zIjogWyIyMDAiLCAiNDA0IiwgIjUwMCIsICI0MDMiXSwgImMiOiAxfSwgeyJxIjogIkNlIGZhY2UgY29tYW5kYSBgZ2l0IGNvbW1pdGAgw65uIEdpdD8iLCAib3B0aW9ucyI6IFsiVHJpbWl0ZSBzY2hpbWLEg3JpbGUgcGUgc2VydmVyIiwgIlNhbHZlYXrEgyBzY2hpbWLEg3JpbGUgbG9jYWwiLCAiQ3JlZWF6xIMgdW4gYnJhbmNoIiwgIsiYdGVyZ2UgZmnImWllcmUiXSwgImMiOiAxfSwgeyJxIjogIkNlIGUgdW4gUkVTVCBBUEk/IiwgIm9wdGlvbnMiOiBbIk8gYmF6xIMgZGUgZGF0ZSIsICJPIGFyaGl0ZWN0dXLEgyBkZSBjb211bmljYXJlIHdlYiIsICJVbiBsaW1iYWogZGUgcHJvZ3JhbWFyZSIsICJVbiBmcmFtZXdvcmsiXSwgImMiOiAxfSwgeyJxIjogIkNlIGZhY2UgYGdpdCBwdWxsYCDDrm4gR2l0PyIsICJvcHRpb25zIjogWyLImHRlcmdlIGJyYW5jaC11bCIsICJBZHVjZSB1bHRpbWVsZSBzY2hpbWLEg3JpIGRlIHBlIHNlcnZlciIsICJDcmVlYXrEgyB1biBjb21taXQiLCAiUmVzZXRlYXrEgyByZXBvc2l0b3J5LXVsIl0sICJjIjogMX0sIHsicSI6ICJDZSBjb2QgSFRUUCDDrm5zZWFtbsSDICdTdWNjZXNzJz8iLCAib3B0aW9ucyI6IFsiMTAwIiwgIjIwMCIsICIzMDAiLCAiNDAwIl0sICJjIjogMX0sIHsicSI6ICJDZSBjb21wbGV4aXRhdGUgYXJlIHNvcnRhcmVhIHByaW4gUXVpY2sgU29ydCDDrm4gbWVkaWU/IiwgIm9wdGlvbnMiOiBbIk8oMSkiLCAiTyhuKSIsICJPKG4gbG9nIG4pIiwgIk8obsKyKSJdLCAiYyI6IDJ9LCB7InEiOiAiQ2UgZSB1biBoYXNoIG1hcD8iLCAib3B0aW9ucyI6IFsiVW4gYXJyYXkiLCAiTyBzdHJ1Y3R1csSDIGN1IGNoZWllLXZhbG9hcmUiLCAiTyBsaXN0xIMiLCAiVW4gYXJib3JlIl0sICJjIjogMX1d";
            const k = [2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1, 1, 1, 1, 2, 0, 1, 1, 2, 1, 2, 1, 1, 3, 2, 1, 1, 1, 1, 1, 1, 2, 1];
            try {
                // Fix UTF-8 decoding dupƒÉ atob()
                const base64Decoded = atob(e);
                const utf8Decoded = decodeURIComponent(Array.from(base64Decoded).map(c => 
                    '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
                ).join(''));
                const p = JSON.parse(utf8Decoded);
                return p.map((q, i) => ({q: q.q, options: q.options, correct: k[i]}));
            } catch(err) {
                console.error('Decode error:', err);
                return [];
            }
        })();
        
        // ============================================
        // STATE
        // ============================================
        
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let selectedOption = null;
        let startTime = null;
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        window.onload = function() {
            // VerificƒÉ dacƒÉ a revendicat deja premiul
            if (localStorage.getItem(CONFIG.LOCAL_STORAGE_KEY)) {
                showAlreadyPlayedScreen();
                return;
            }
            
            // VerificƒÉ dacƒÉ a terminat quiz-ul dar nu a revendicat √ÆncƒÉ
            const savedScore = localStorage.getItem(CONFIG.SCORE_STORAGE_KEY);
            const savedTier = localStorage.getItem(CONFIG.TIER_STORAGE_KEY);
            
            if (savedScore !== null && savedTier !== null) {
                const score = parseInt(savedScore);
                
                // DacƒÉ scorul = 0, »ôterge rezultatul »ôi permite reluare
                if (score === 0) {
                    localStorage.removeItem(CONFIG.SCORE_STORAGE_KEY);
                    localStorage.removeItem(CONFIG.TIER_STORAGE_KEY);
                    clearQuizProgress();
                } else {
                    // Are scor > 0, trebuie sƒÉ meargƒÉ la ecranul de revendicare
                    displayResults(score, savedTier);
                    return;
                }
            }
            
            // VerificƒÉ dacƒÉ are quiz √Æn progres - continuƒÉ de unde a rƒÉmas
            if (localStorage.getItem(CONFIG.IN_PROGRESS_KEY)) {
                const savedState = JSON.parse(localStorage.getItem(CONFIG.IN_PROGRESS_KEY));
                currentQuestions = savedState.questions;
                currentQuestionIndex = savedState.currentIndex;
                userAnswers = savedState.answers;
                startTime = savedState.startTime;
                showScreen('quizScreen');
                displayQuestion();
                return;
            }
            
            if (CONFIG.USE_TOKENS) {
                document.getElementById('tokenInputGroup').style.display = 'block';
            }
        };
        
        function saveQuizProgress() {
            const state = {
                questions: currentQuestions,
                currentIndex: currentQuestionIndex,
                answers: userAnswers,
                startTime: startTime
            };
            localStorage.setItem(CONFIG.IN_PROGRESS_KEY, JSON.stringify(state));
        }
        
        function clearQuizProgress() {
            localStorage.removeItem(CONFIG.IN_PROGRESS_KEY);
        }
        
        function retryQuiz() {
            // »òterge toate datele salvate
            localStorage.removeItem(CONFIG.SCORE_STORAGE_KEY);
            localStorage.removeItem(CONFIG.TIER_STORAGE_KEY);
            clearQuizProgress();
            
            // ReseteazƒÉ variabilele
            currentQuestions = [];
            currentQuestionIndex = 0;
            userAnswers = [];
            selectedOption = null;
            
            // Re√Æncepe de la ecranul de start
            showScreen('startScreen');
        }
        
        function claimPrize() {
            // MarcheazƒÉ ca revendicat
            localStorage.setItem(CONFIG.LOCAL_STORAGE_KEY, '1');
            // »òterge progresul salvat
            clearQuizProgress();
            // Afi»ôeazƒÉ ecranul "ai participat deja" cu rezultatul
            showAlreadyPlayedScreen();
        }
        
        function showAlreadyPlayedScreen() {
            const previousScore = localStorage.getItem(CONFIG.SCORE_STORAGE_KEY);
            const previousTier = localStorage.getItem(CONFIG.TIER_STORAGE_KEY);
            
            if (previousScore && previousTier) {
                document.getElementById('previousScore').textContent = `${previousScore}/${CONFIG.NUM_QUESTIONS}`;
                const tierBadge = document.getElementById('previousTierBadge');
                tierBadge.innerHTML = `<div class="tier-badge tier-${previousTier.toLowerCase()}">${previousTier}</div>`;
                const messages = {
                    'T1': 'ÔøΩ Bun √Ænceput! Premiul tƒÉu GALBEN!',
                    'T2': 'üëè Foarte bine! Premiul tƒÉu PORTOCALIU!',
                    'T3': 'ÔøΩ Excelent! Premiul tƒÉu VERDE!'
                };
                document.getElementById('previousTierMessage').textContent = messages[previousTier];
            } else {
                document.getElementById('previousResultContainer').style.display = 'none';
            }
            showScreen('alreadyPlayedScreen');
        }
        
        // ============================================
        // NAVIGATION
        // ============================================
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        // ============================================
        // QUIZ LOGIC
        // ============================================
        
        function startQuiz() {
            startTime = Date.now();
            
            // RandomizeazƒÉ »ôi selecteazƒÉ √ÆntrebƒÉri
            const shuffled = [...questionBank].sort(() => Math.random() - 0.5);
            currentQuestions = shuffled.slice(0, CONFIG.NUM_QUESTIONS);
            
            currentQuestionIndex = 0;
            userAnswers = [];
            
            // SalveazƒÉ starea - quiz-ul a √Ænceput!
            saveQuizProgress();
            
            showScreen('quizScreen');
            displayQuestion();
        }
        
        function displayQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            
            document.getElementById('questionCounter').textContent = 
                `√éntrebarea ${currentQuestionIndex + 1} din ${CONFIG.NUM_QUESTIONS}`;
            
            document.getElementById('questionText').textContent = question.q;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            selectedOption = null;
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('nextBtn').textContent = 
                currentQuestionIndex === CONFIG.NUM_QUESTIONS - 1 ? 'FinalizeazƒÉ' : 'UrmƒÉtoarea';
        }
        
        function selectOption(index) {
            selectedOption = index;
            
            document.querySelectorAll('.option').forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });
            
            document.getElementById('nextBtn').disabled = false;
        }
        
        function nextQuestion() {
            if (selectedOption === null) return;
            
            userAnswers.push(selectedOption);
            
            if (currentQuestionIndex < CONFIG.NUM_QUESTIONS - 1) {
                currentQuestionIndex++;
                saveQuizProgress(); // SalveazƒÉ progresul dupƒÉ fiecare rƒÉspuns
                displayQuestion();
            } else {
                finishQuiz();
            }
        }
        
        // ============================================
        // RESULTS
        // ============================================
        
        function finishQuiz() {
            const score = calculateScore();
            const tier = getTier(score);
            const duration = Math.round((Date.now() - startTime) / 1000);
            
            // SalveazƒÉ doar rezultatul (NU marcheazƒÉ ca revendicat √ÆncƒÉ)
            localStorage.setItem(CONFIG.SCORE_STORAGE_KEY, score);
            localStorage.setItem(CONFIG.TIER_STORAGE_KEY, tier);
            
            // Quiz-ul s-a terminat - nu mai e nevoie sƒÉ salvƒÉm progresul
            clearQuizProgress();
            
            if (CONFIG.BACKEND_URL) {
                submitToBackend(score, duration);
            }
            
            displayResults(score, tier);
        }
        
        function calculateScore() {
            let correct = 0;
            currentQuestions.forEach((q, i) => {
                if (userAnswers[i] === q.correct) {
                    correct++;
                }
            });
            return correct;
        }
        
        function getTier(score) {
            if (score <= 1) return 'T1';  // 0-1/3 = T1 Galben
            if (score === 2) return 'T2';  // 2/3 = T2 Portocaliu
            return 'T3';                   // 3/3 = T3 Verde
        }
        
        function displayResults(score, tier) {
            showScreen('resultScreen');
            
            document.getElementById('scoreDisplay').textContent = `${score}/${CONFIG.NUM_QUESTIONS}`;
            
            const tierBadge = document.getElementById('tierBadge');
            tierBadge.innerHTML = `<div class="tier-badge tier-${tier.toLowerCase()}">${tier}</div>`;
            
            const messages = {
                'T1': 'Bun √Ænceput! üåü ContinuƒÉ sƒÉ √Ænve»õi! Mergi la stand pentru premiul tƒÉu GALBEN!',
                'T2': 'Foarte bine! üëè E»ôti pe drumul cel bun! Mergi la stand pentru premiul tƒÉu PORTOCALIU!',
                'T3': 'Excelent! üéâ Ai rƒÉspuns corect la toate! Mergi la stand pentru premiul tƒÉu VERDE!'
            };
            
            document.getElementById('tierMessage').textContent = messages[tier];
            
            // Afi»ôeazƒÉ sau ascunde butonul de revendicare √Æn func»õie de scor
            const claimSection = document.getElementById('claimPrizeSection');
            const retrySection = document.getElementById('retrySection');
            
            if (score === 0) {
                // Scor 0 - permite reluare
                claimSection.style.display = 'none';
                retrySection.style.display = 'block';
            } else {
                // Scor > 0 - afi»ôeazƒÉ buton revendicare
                claimSection.style.display = 'block';
                retrySection.style.display = 'none';
            }
        }
        
        // ============================================
        // BACKEND INTEGRATION
        // ============================================
        
        function submitToBackend(score, duration) {
            const token = document.getElementById('tokenInput').value.trim();
            
            const payload = {
                token: token || null,
                answers: userAnswers,
                score: score,
                ts: new Date().toISOString(),
                duration: duration
            };
            
            fetch(CONFIG.BACKEND_URL, {
                method: 'POST',
                mode: 'no-cors', // Apps Script cere no-cors
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            }).catch(err => {
                console.log('Backend submission error (expected with no-cors):', err);
            });
        }
    </script>
</body>
</html>
