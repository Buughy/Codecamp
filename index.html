<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeCamp Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .visma-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #ED1B2F;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .visma-logo {
            height: 150px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        
        .codecamp-badge {
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        h1 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            color: #6b7280;
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 500;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.2s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }
        
        .btn-primary {
            background: #ED1B2F;
            color: white;
        }
        
        .btn-primary:hover {
            background: #D91828;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(237, 27, 47, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .question-counter {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .question-text {
            color: #1f2937;
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.5;
            font-weight: 500;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            padding: 14px 18px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            text-align: left;
        }
        
        .option:hover {
            border-color: #667eea;
            background: #f9fafb;
        }
        
        .option.selected {
            border-color: #ED1B2F;
            background: #FFE8EA;
        }
        
        .result-screen {
            text-align: center;
        }
        
        .score-display {
            font-size: 4em;
            font-weight: 700;
            margin: 20px 0;
        }
        
        .tier-badge {
            display: inline-block;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.8em;
            font-weight: 700;
            color: white;
            margin: 20px 0;
        }
        
        .tier-t1 {
            background: #EAB308; /* Galben - 1/3 */
        }
        
        .tier-t2 {
            background: #EA580C; /* Portocaliu - 2/3 */
        }
        
        .tier-t3 {
            background: #16A34A; /* Verde - 3/3 */
        }
        
        .tier-message {
            font-size: 1.2em;
            color: #374151;
            margin: 20px 0;
            line-height: 1.6;
        }
        
        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .info-message {
            background: #dbeafe;
            color: #1e40af;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .already-played {
            text-align: center;
            padding: 40px 20px;
        }
        
        .already-played h2 {
            color: #1f2937;
            margin-bottom: 15px;
        }
        
        .already-played p {
            color: #6b7280;
            line-height: 1.6;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 25px;
            }
            
            h1 {
                font-size: 1.6em;
            }
            
            .score-display {
                font-size: 3em;
            }
            
            .tier-badge {
                font-size: 1.4em;
                padding: 12px 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Visma Logo Header -->
        <div class="visma-header">
            <img src="Visma_logo.png" alt="Visma Logo" class="visma-logo">
            <div class="codecamp-badge">CodeCamp Quiz</div>
        </div>
        
        <!-- Start Screen -->
        <div id="startScreen" class="screen active">
            <h1>üöÄ Test Your Knowledge</h1>
            <p class="subtitle">3 programming questions to evaluate your skills!</p>
            
            <div class="input-group" id="tokenInputGroup" style="display: none;">
                <label for="tokenInput">Token (optional):</label>
                <input type="text" id="tokenInput" placeholder="Enter your unique token">
                <div class="info-message" style="margin-top: 10px;">
                    If you received a token, enter it above. Otherwise, you can continue without a token.
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="startQuiz()">Start Quiz</button>
        </div>
        
        <!-- Quiz Screen -->
        <div id="quizScreen" class="screen">
            <div class="question-counter" id="questionCounter"></div>
            <div class="question-text" id="questionText"></div>
            <div class="options" id="optionsContainer"></div>
            <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next</button>
        </div>
        
        <!-- Result Screen -->
        <div id="resultScreen" class="screen">
            <div class="result-screen">
                <h1>Your Result</h1>
                <div class="score-display" id="scoreDisplay"></div>
                <div id="tierBadge"></div>
                <div class="tier-message" id="tierMessage"></div>
                
                <!-- Claim prize section (for score > 0) -->
                <div id="claimPrizeSection" style="margin-top: 30px; padding: 20px; background: #FFE8EA; border-radius: 12px; border: 2px solid #ED1B2F;">
                    <p style="color: #991B1B; font-weight: 600; margin-bottom: 15px; font-size: 1.1em;">
                        ‚ö†Ô∏è Attention! This button must be pressed in the presence of booth staff to confirm prize claim.
                    </p>
                    <button class="btn btn-primary" onclick="claimPrize()" style="font-size: 1.2em; padding: 15px 40px; width: 100%;">
                        üéÅ Claim Prize
                    </button>
                </div>
                
                <!-- Retry section (for score = 0) -->
                <div id="retrySection" style="display: none; margin-top: 30px; padding: 20px; background: #FEE2E2; border-radius: 12px; border: 2px solid #ED1B2F;">
                    <p style="color: #991B1B; font-weight: 600; margin-bottom: 15px; font-size: 1.1em;">
                        Unfortunately you didn't answer any question correctly. You can try again!
                    </p>
                    <button class="btn" onclick="retryQuiz()" style="font-size: 1.2em; padding: 15px 40px; width: 100%; background: #ED1B2F; color: white;">
                        üîÑ Try Again
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Already Played Screen -->
        <div id="alreadyPlayedScreen" class="screen">
            <div class="already-played">
                <h2>‚úÖ You've Already Participated!</h2>
                <p>Thank you for participating! You can only play once to keep the competition fair.</p>
                
                <div id="previousResultContainer" style="margin: 30px 0;">
                    <h3 style="color: #374151; margin-bottom: 15px;">Your previous result:</h3>
                    <div class="score-display" id="previousScore" style="font-size: 3em;"></div>
                    <div id="previousTierBadge"></div>
                    <div class="tier-message" id="previousTierMessage" style="font-size: 1.1em;"></div>
                </div>
                
                <p style="margin-top: 20px; font-weight: 600; color: #1f2937;">Visit the booth to claim your prize!</p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURARE
        // ============================================
        
        const CONFIG = {
            BACKEND_URL: null,
            NUM_QUESTIONS: 3,
            LOCAL_STORAGE_KEY: 'cc_quiz_played',
            SCORE_STORAGE_KEY: 'cc_quiz_score',
            TIER_STORAGE_KEY: 'cc_quiz_tier',
            IN_PROGRESS_KEY: 'cc_quiz_in_progress',
            USE_TOKENS: false
        };
        
        // ============================================
        // QUESTION BANK (30+ √ÆntrebƒÉri)
        // ============================================
        
        const questionBank = (() => {
            // Encoded questions for anti-cheat
            const e = "W3sicSI6ICJXaGF0IGRvZXMgYHR5cGVvZiBudWxsYCByZXR1cm4gaW4gSmF2YVNjcmlwdD8iLCAib3B0aW9ucyI6IFsiJ251bGwnIiwgIid1bmRlZmluZWQnIiwgIidvYmplY3QnIiwgIidudW1iZXInIl0sICJjIjogMn0sIHsicSI6ICJXaGF0IGRvZXMgYGNvbnNvbGUubG9nKDAuMSArIDAuMiA9PT0gMC4zKWAgZGlzcGxheSBpbiBKYXZhU2NyaXB0PyIsICJvcHRpb25zIjogWyJ0cnVlIiwgImZhbHNlIiwgInVuZGVmaW5lZCIsICJOYU4iXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyBgQXJyYXkucHJvdG90eXBlLm1hcCgpYCBkbyBpbiBKYXZhU2NyaXB0PyIsICJvcHRpb25zIjogWyJNb2RpZmllcyB0aGUgb3JpZ2luYWwgYXJyYXkiLCAiQ3JlYXRlcyBhIG5ldyBhcnJheSB3aXRoIGZ1bmN0aW9uIHJlc3VsdHMiLCAiRmlsdGVycyBlbGVtZW50cyIsICJTb3J0cyB0aGUgYXJyYXkiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgdHlwZSBvZiB2YXJpYWJsZSBDQU5OT1QgYmUgcmVhc3NpZ25lZCBpbiBKYXZhU2NyaXB0PyIsICJvcHRpb25zIjogWyJ2YXIiLCAibGV0IiwgImNvbnN0IiwgImZ1bmN0aW9uIl0sICJjIjogMn0sIHsicSI6ICJXaGF0IGRvZXMgYGNvbnNvbGUubG9nKDEgKyAnMScpYCBkaXNwbGF5IGluIEphdmFTY3JpcHQ/IiwgIm9wdGlvbnMiOiBbIjIiLCAiJzExJyIsICIxMSIsICJ1bmRlZmluZWQiXSwgImMiOiAxfSwgeyJxIjogIldoYXQncyB0aGUgbWFpbiBkaWZmZXJlbmNlIGJldHdlZW4gYD09YCBhbmQgYD09PWAgaW4gSmF2YVNjcmlwdD8iLCAib3B0aW9ucyI6IFsiVGhlcmUgaXMgbm8gZGlmZmVyZW5jZSIsICJgPT09YCBhbHNvIGNoZWNrcyB0eXBlIiwgImA9PWAgaXMgZmFzdGVyIiwgImA9PT1gIG9ubHkgd29ya3Mgd2l0aCBudW1iZXJzIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgYGFzeW5jL2F3YWl0YCBkbyBpbiBKYXZhU2NyaXB0PyIsICJvcHRpb25zIjogWyJDcmVhdGVzIG5ldyB0aHJlYWRzIiwgIlNpbXBsaWZpZXMgd29ya2luZyB3aXRoIFByb21pc2VzIiwgIlN0b3BzIHByb2dyYW0gZXhlY3V0aW9uIiwgIkNyZWF0ZXMgYXN5bmMgdmFyaWFibGVzIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgYFsxLCAyLCAzXS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKWAgcmV0dXJuIGluIEphdmFTY3JpcHQ/IiwgIm9wdGlvbnMiOiBbIjAiLCAiNiIsICJbMSwyLDNdIiwgInVuZGVmaW5lZCJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBkb2VzIGBldmVudC5wcmV2ZW50RGVmYXVsdCgpYCBkbyBpbiBKYXZhU2NyaXB0PyIsICJvcHRpb25zIjogWyJEZWxldGVzIHRoZSBldmVudCIsICJQcmV2ZW50cyBkZWZhdWx0IGJyb3dzZXIgYmVoYXZpb3IiLCAiQ3JlYXRlcyBhIG5ldyBldmVudCIsICJTdG9wcyBwcm9wYWdhdGlvbiJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBpcyBhIGNsb3N1cmUgaW4gSmF2YVNjcmlwdD8iLCAib3B0aW9ucyI6IFsiQSBjbG9zZWQgZnVuY3Rpb24iLCAiQSBmdW5jdGlvbiB0aGF0IHJldGFpbnMgdGhlIHNjb3BlIGluIHdoaWNoIGl0IHdhcyBjcmVhdGVkIiwgIkEgY29uc3RhbnQgdmFyaWFibGUiLCAiQSBwcml2YXRlIGNsYXNzIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgYCEhMGAgcmV0dXJuIGluIEphdmFTY3JpcHQ/IiwgIm9wdGlvbnMiOiBbInRydWUiLCAiZmFsc2UiLCAiMCIsICJ1bmRlZmluZWQiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyBgSlNPTi5wYXJzZSgpYCBkbyBpbiBKYXZhU2NyaXB0PyIsICJvcHRpb25zIjogWyJDb252ZXJ0cyBhbiBvYmplY3QgdG8gYSBzdHJpbmciLCAiQ29udmVydHMgYSBKU09OIHN0cmluZyB0byBhbiBvYmplY3QiLCAiVmFsaWRhdGVzIEpTT04iLCAiQ29tcHJlc3NlcyBKU09OIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IG1vZGlmaWVyIG1ha2VzIGEgdmFyaWFibGUgY29uc3RhbnQgaW4gSmF2YT8iLCAib3B0aW9ucyI6IFsiY29uc3QiLCAiZmluYWwiLCAic3RhdGljIiwgInJlYWRvbmx5Il0sICJjIjogMX0sIHsicSI6ICJXaGF0IGlzIGFuIGludGVyZmFjZSBpbiBKYXZhPyIsICJvcHRpb25zIjogWyJBbiBhYnN0cmFjdCBjbGFzcyIsICJBIGNvbnRyYWN0IHdpdGggdW5pbXBsZW1lbnRlZCBtZXRob2RzIiwgIkFuIGFycmF5IHR5cGUiLCAiQSBzdGF0aWMgZnVuY3Rpb24iXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyB0aGUgYHN0YXRpY2Aga2V5d29yZCBkbyBpbiBKYXZhPyIsICJvcHRpb25zIjogWyJNYWtlcyB0aGUgY2xhc3MgZmluYWwiLCAiTWFrZXMgdGhlIG1lbWJlciBiZWxvbmcgdG8gdGhlIGNsYXNzLCBub3QgdGhlIGluc3RhbmNlIiwgIlByZXZlbnRzIGluaGVyaXRhbmNlIiwgIk1ha2VzIHRoZSBtZXRob2QgcHJpdmF0ZSJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCB0eXBlIGRvZXMgYHZvaWRgIHJldHVybiBpbiBKYXZhPyIsICJvcHRpb25zIjogWyJudWxsIiwgIjAiLCAiZmFsc2UiLCAiTm90aGluZyAobm8gdHlwZSkiXSwgImMiOiAzfSwgeyJxIjogIldoYXQgZG9lcyBgQXJyYXlMaXN0YCBkbyBpbiBKYXZhPyIsICJvcHRpb25zIjogWyJDcmVhdGVzIGEgZml4ZWQgYXJyYXkiLCAiQ3JlYXRlcyBhIGR5bmFtaWMgbGlzdCIsICJTb3J0cyBhbiBhcnJheSIsICJDcmVhdGVzIGEgaGFzaG1hcCJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBpcyBwb2x5bW9ycGhpc20gaW4gSmF2YT8iLCAib3B0aW9ucyI6IFsiTXVsdGlwbGUgaW5oZXJpdGFuY2UiLCAiTXVsdGlwbGUgZm9ybXMgb2YgdGhlIHNhbWUgdGhpbmciLCAiQW4gaW50ZXJmYWNlIiwgIkFuIGFic3RyYWN0IGNsYXNzIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgYHRyeS1jYXRjaGAgZG8gaW4gSmF2YT8iLCAib3B0aW9ucyI6IFsiT3B0aW1pemVzIGNvZGUiLCAiSGFuZGxlcyBleGNlcHRpb25zIiwgIkNyZWF0ZXMgdGhyZWFkcyIsICJWYWxpZGF0ZXMgaW5wdXQiXSwgImMiOiAxfSwgeyJxIjogIldoYXQncyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGA9PWAgYW5kIGAuZXF1YWxzKClgIGluIEphdmEgZm9yIFN0cmluZ3M/IiwgIm9wdGlvbnMiOiBbIlRoZXJlIGlzIG5vIGRpZmZlcmVuY2UiLCAiYD09YCBjb21wYXJlcyByZWZlcmVuY2VzLCBgLmVxdWFscygpYCBjb21wYXJlcyBjb250ZW50IiwgImAuZXF1YWxzKClgIGlzIGZhc3RlciIsICJgPT1gIGlzIGRlcHJlY2F0ZWQiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyBgbGlzdC5hcHBlbmQoKWAgZG8gaW4gUHl0aG9uPyIsICJvcHRpb25zIjogWyJEZWxldGVzIHRoZSBsYXN0IGVsZW1lbnQiLCAiQWRkcyBhbiBlbGVtZW50IGF0IHRoZSBlbmQiLCAiU29ydHMgdGhlIGxpc3QiLCAiQ3JlYXRlcyBhIGNvcHkiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyBgbGVuKFsxLCAyLCAzXSlgIHJldHVybiBpbiBQeXRob24/IiwgIm9wdGlvbnMiOiBbIjEiLCAiMiIsICIzIiwgIjYiXSwgImMiOiAyfSwgeyJxIjogIldoYXQgZG9lcyBgcmFuZ2UoNSlgIGRvIGluIFB5dGhvbj8iLCAib3B0aW9ucyI6IFsiQ3JlYXRlcyBbMCwxLDIsMyw0XSIsICJDcmVhdGVzIFsxLDIsMyw0LDVdIiwgIkNyZWF0ZXMgNSIsICJDcmVhdGVzIGEgc3RyaW5nIl0sICJjIjogMH0sIHsicSI6ICJXaGF0IGlzIGEgZGVjb3JhdG9yIGluIFB5dGhvbj8iLCAib3B0aW9ucyI6IFsiQSBjbGFzcyIsICJBIGZ1bmN0aW9uIHRoYXQgbW9kaWZpZXMgYW5vdGhlciBmdW5jdGlvbiIsICJBIGNvbW1lbnQiLCAiQSBnbG9iYWwgdmFyaWFibGUiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyBgZGljdC5nZXQoJ2tleScpYCBkbyBpbiBQeXRob24/IiwgIm9wdGlvbnMiOiBbIlRocm93cyBhbiBlcnJvciBpZiBrZXkgZG9lc24ndCBleGlzdCIsICJSZXR1cm5zIHRoZSB2YWx1ZSBvciBOb25lIiwgIkRlbGV0ZXMgdGhlIGtleSIsICJNb2RpZmllcyB0aGUgZGljdGlvbmFyeSJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCB0eXBlIGlzIGBUcnVlYCBpbiBQeXRob24/IiwgIm9wdGlvbnMiOiBbImludCIsICJzdHIiLCAiYm9vbCIsICJmbG9hdCJdLCAiYyI6IDJ9LCB7InEiOiAiV2hhdCBkb2VzIGBTRUxFQ1QgRElTVElOQ1RgIGRvIGluIFNRTD8iLCAib3B0aW9ucyI6IFsiU2VsZWN0cyBhbGwgcm93cyIsICJTZWxlY3RzIG9ubHkgdW5pcXVlIHJvd3MiLCAiU29ydHMgdGhlIHJlc3VsdHMiLCAiRGVsZXRlcyBkdXBsaWNhdGVzIGZyb20gdGhlIHRhYmxlIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IHR5cGUgb2YgSk9JTiByZXR1cm5zIG9ubHkgY29tbW9uIHJvd3MgZnJvbSBib3RoIHRhYmxlcz8iLCAib3B0aW9ucyI6IFsiTEVGVCBKT0lOIiwgIlJJR0hUIEpPSU4iLCAiSU5ORVIgSk9JTiIsICJPVVRFUiBKT0lOIl0sICJjIjogMn0sIHsicSI6ICJXaGF0IGRvZXMgdGhlIGNvbW1hbmQgYERFTEVURSBGUk9NIHVzZXJzIFdIRVJFIGlkPTVgIGRvIGluIFNRTD8iLCAib3B0aW9ucyI6IFsiRGVsZXRlcyBhbGwgcm93cyIsICJEZWxldGVzIHRoZSB1c2VyIHdpdGggaWQ9NSIsICJVcGRhdGVzIHRoZSB1c2VyIiwgIlNlbGVjdHMgdGhlIHVzZXIiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyBgQ09VTlQoKilgIGRvIGluIFNRTD8iLCAib3B0aW9ucyI6IFsiTXVsdGlwbGllcyB2YWx1ZXMiLCAiQ291bnRzIHRoZSBudW1iZXIgb2Ygcm93cyIsICJDYWxjdWxhdGVzIHRoZSBhdmVyYWdlIiwgIlNvcnRzIHRoZSBkYXRhIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGluZGV4IGltcHJvdmVzIFNRTCBxdWVyeSBwZXJmb3JtYW5jZT8iLCAib3B0aW9ucyI6IFsiUFJJTUFSWSBLRVkiLCAiSU5ERVgiLCAiVU5JUVVFIiwgIkFsbCB2YXJpYW50cyJdLCAiYyI6IDN9LCB7InEiOiAiV2hhdCBpcyB0aGUgdGltZSBjb21wbGV4aXR5IG9mIHNlYXJjaGluZyBhbiB1bnNvcnRlZCBhcnJheT8iLCAib3B0aW9ucyI6IFsiTygxKSIsICJPKGxvZyBuKSIsICJPKG4pIiwgIk8obsKyKSJdLCAiYyI6IDJ9LCB7InEiOiAiV2hhdCBkYXRhIHN0cnVjdHVyZSBmb2xsb3dzIHRoZSBMSUZPIHByaW5jaXBsZT8iLCAib3B0aW9ucyI6IFsiUXVldWUiLCAiU3RhY2siLCAiQXJyYXkiLCAiVHJlZSJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBIVFRQIGNvZGUgbWVhbnMgJ05vdCBGb3VuZCc/IiwgIm9wdGlvbnMiOiBbIjIwMCIsICI0MDQiLCAiNTAwIiwgIjQwMyJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBkb2VzIGBnaXQgY29tbWl0YCBkbyBpbiBHaXQ/IiwgIm9wdGlvbnMiOiBbIlNlbmRzIGNoYW5nZXMgdG8gdGhlIHNlcnZlciIsICJTYXZlcyBjaGFuZ2VzIGxvY2FsbHkiLCAiQ3JlYXRlcyBhIGJyYW5jaCIsICJEZWxldGVzIGEgZmlsZSJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBpcyBhIFJFU1QgQVBJPyIsICJvcHRpb25zIjogWyJBIGRhdGFiYXNlIiwgIkEgd2ViIGNvbW11bmljYXRpb24gYXJjaGl0ZWN0dXJlIiwgIkEgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2UiLCAiQSBmcmFtZXdvcmsiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyBgZ2l0IHB1bGxgIGRvIGluIEdpdD8iLCAib3B0aW9ucyI6IFsiRGVsZXRlcyB0aGUgYnJhbmNoIiwgIkZldGNoZXMgdGhlIGxhdGVzdCBjaGFuZ2VzIGZyb20gdGhlIHNlcnZlciIsICJDcmVhdGVzIGEgY29tbWl0IiwgIlJlc2V0cyB0aGUgcmVwb3NpdG9yeSJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBIVFRQIGNvZGUgbWVhbnMgJ1N1Y2Nlc3MnPyIsICJvcHRpb25zIjogWyIxMDAiLCAiMjAwIiwgIjMwMCIsICI0MDAiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgaXMgdGhlIGF2ZXJhZ2UgY29tcGxleGl0eSBvZiBRdWljayBTb3J0PyIsICJvcHRpb25zIjogWyJPKDEpIiwgIk8obikiLCAiTyhuIGxvZyBuKSIsICJPKG7CsikiXSwgImMiOiAyfSwgeyJxIjogIldoYXQgaXMgYSBoYXNoIG1hcD8iLCAib3B0aW9ucyI6IFsiQW4gYXJyYXkiLCAiQSBrZXktdmFsdWUgc3RydWN0dXJlIiwgIkEgbGlzdCIsICJBIHRyZWUiXSwgImMiOiAxfV0=";
            const k = [2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 1, 1, 1, 1, 2, 0, 1, 1, 2, 1, 2, 1, 1, 3, 2, 1, 1, 1, 1, 1, 1, 2, 1];
            try {
                // Fix UTF-8 decoding dupƒÉ atob()
                const base64Decoded = atob(e);
                const utf8Decoded = decodeURIComponent(Array.from(base64Decoded).map(c => 
                    '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
                ).join(''));
                const p = JSON.parse(utf8Decoded);
                return p.map((q, i) => ({q: q.q, options: q.options, correct: k[i]}));
            } catch(err) {
                console.error('Decode error:', err);
                return [];
            }
        })();
        
        // ============================================
        // STATE
        // ============================================
        
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let selectedOption = null;
        let startTime = null;
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        window.onload = function() {
            // VerificƒÉ dacƒÉ a revendicat deja premiul
            if (localStorage.getItem(CONFIG.LOCAL_STORAGE_KEY)) {
                showAlreadyPlayedScreen();
                return;
            }
            
            // VerificƒÉ dacƒÉ a terminat quiz-ul dar nu a revendicat √ÆncƒÉ
            const savedScore = localStorage.getItem(CONFIG.SCORE_STORAGE_KEY);
            const savedTier = localStorage.getItem(CONFIG.TIER_STORAGE_KEY);
            
            if (savedScore !== null && savedTier !== null) {
                const score = parseInt(savedScore);
                
                // DacƒÉ scorul = 0, »ôterge rezultatul »ôi permite reluare
                if (score === 0) {
                    localStorage.removeItem(CONFIG.SCORE_STORAGE_KEY);
                    localStorage.removeItem(CONFIG.TIER_STORAGE_KEY);
                    clearQuizProgress();
                } else {
                    // Are scor > 0, trebuie sƒÉ meargƒÉ la ecranul de revendicare
                    displayResults(score, savedTier);
                    return;
                }
            }
            
            // VerificƒÉ dacƒÉ are quiz √Æn progres - continuƒÉ de unde a rƒÉmas
            if (localStorage.getItem(CONFIG.IN_PROGRESS_KEY)) {
                const savedState = JSON.parse(localStorage.getItem(CONFIG.IN_PROGRESS_KEY));
                currentQuestions = savedState.questions;
                currentQuestionIndex = savedState.currentIndex;
                userAnswers = savedState.answers;
                startTime = savedState.startTime;
                showScreen('quizScreen');
                displayQuestion();
                return;
            }
            
            if (CONFIG.USE_TOKENS) {
                document.getElementById('tokenInputGroup').style.display = 'block';
            }
        };
        
        function saveQuizProgress() {
            const state = {
                questions: currentQuestions,
                currentIndex: currentQuestionIndex,
                answers: userAnswers,
                startTime: startTime
            };
            localStorage.setItem(CONFIG.IN_PROGRESS_KEY, JSON.stringify(state));
        }
        
        function clearQuizProgress() {
            localStorage.removeItem(CONFIG.IN_PROGRESS_KEY);
        }
        
        function retryQuiz() {
            // »òterge toate datele salvate
            localStorage.removeItem(CONFIG.SCORE_STORAGE_KEY);
            localStorage.removeItem(CONFIG.TIER_STORAGE_KEY);
            clearQuizProgress();
            
            // ReseteazƒÉ variabilele
            currentQuestions = [];
            currentQuestionIndex = 0;
            userAnswers = [];
            selectedOption = null;
            
            // Re√Æncepe de la ecranul de start
            showScreen('startScreen');
        }
        
        function claimPrize() {
            // MarcheazƒÉ ca revendicat
            localStorage.setItem(CONFIG.LOCAL_STORAGE_KEY, '1');
            // »òterge progresul salvat
            clearQuizProgress();
            // Afi»ôeazƒÉ ecranul "ai participat deja" cu rezultatul
            showAlreadyPlayedScreen();
        }
        
        function showAlreadyPlayedScreen() {
            const previousScore = localStorage.getItem(CONFIG.SCORE_STORAGE_KEY);
            const previousTier = localStorage.getItem(CONFIG.TIER_STORAGE_KEY);
            
            if (previousScore && previousTier) {
                document.getElementById('previousScore').textContent = `${previousScore}/${CONFIG.NUM_QUESTIONS}`;
                const tierBadge = document.getElementById('previousTierBadge');
                tierBadge.innerHTML = `<div class="tier-badge tier-${previousTier.toLowerCase()}">${previousTier}</div>`;
                const messages = {
                    'T1': 'üåü Good start! Your YELLOW prize!',
                    'T2': 'üëè Very good! Your ORANGE prize!',
                    'T3': 'üèÜ Excellent! Your GREEN prize!'
                };
                document.getElementById('previousTierMessage').textContent = messages[previousTier];
            } else {
                document.getElementById('previousResultContainer').style.display = 'none';
            }
            showScreen('alreadyPlayedScreen');
        }
        
        // ============================================
        // NAVIGATION
        // ============================================
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        // ============================================
        // QUIZ LOGIC
        // ============================================
        
        function startQuiz() {
            startTime = Date.now();
            
            // RandomizeazƒÉ »ôi selecteazƒÉ √ÆntrebƒÉri
            const shuffled = [...questionBank].sort(() => Math.random() - 0.5);
            currentQuestions = shuffled.slice(0, CONFIG.NUM_QUESTIONS);
            
            currentQuestionIndex = 0;
            userAnswers = [];
            
            // SalveazƒÉ starea - quiz-ul a √Ænceput!
            saveQuizProgress();
            
            showScreen('quizScreen');
            displayQuestion();
        }
        
        function displayQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            
            document.getElementById('questionCounter').textContent = 
                `Question ${currentQuestionIndex + 1} of ${CONFIG.NUM_QUESTIONS}`;
            
            document.getElementById('questionText').textContent = question.q;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            selectedOption = null;
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('nextBtn').textContent = 
                currentQuestionIndex === CONFIG.NUM_QUESTIONS - 1 ? 'FinalizeazƒÉ' : 'UrmƒÉtoarea';
        }
        
        function selectOption(index) {
            selectedOption = index;
            
            document.querySelectorAll('.option').forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });
            
            document.getElementById('nextBtn').disabled = false;
        }
        
        function nextQuestion() {
            if (selectedOption === null) return;
            
            userAnswers.push(selectedOption);
            
            if (currentQuestionIndex < CONFIG.NUM_QUESTIONS - 1) {
                currentQuestionIndex++;
                saveQuizProgress(); // SalveazƒÉ progresul dupƒÉ fiecare rƒÉspuns
                displayQuestion();
            } else {
                finishQuiz();
            }
        }
        
        // ============================================
        // RESULTS
        // ============================================
        
        function finishQuiz() {
            const score = calculateScore();
            const tier = getTier(score);
            const duration = Math.round((Date.now() - startTime) / 1000);
            
            // SalveazƒÉ doar rezultatul (NU marcheazƒÉ ca revendicat √ÆncƒÉ)
            localStorage.setItem(CONFIG.SCORE_STORAGE_KEY, score);
            localStorage.setItem(CONFIG.TIER_STORAGE_KEY, tier);
            
            // Quiz-ul s-a terminat - nu mai e nevoie sƒÉ salvƒÉm progresul
            clearQuizProgress();
            
            if (CONFIG.BACKEND_URL) {
                submitToBackend(score, duration);
            }
            
            displayResults(score, tier);
        }
        
        function calculateScore() {
            let correct = 0;
            currentQuestions.forEach((q, i) => {
                if (userAnswers[i] === q.correct) {
                    correct++;
                }
            });
            return correct;
        }
        
        function getTier(score) {
            if (score <= 1) return 'T1';  // 0-1/3 = T1 Galben
            if (score === 2) return 'T2';  // 2/3 = T2 Portocaliu
            return 'T3';                   // 3/3 = T3 Verde
        }
        
        function displayResults(score, tier) {
            showScreen('resultScreen');
            
            document.getElementById('scoreDisplay').textContent = `${score}/${CONFIG.NUM_QUESTIONS}`;
            
            const tierBadge = document.getElementById('tierBadge');
            tierBadge.innerHTML = `<div class="tier-badge tier-${tier.toLowerCase()}">${tier}</div>`;
            
            const messages = {
                'T1': 'Good start! üåü Keep learning! Go to the booth for your YELLOW prize!',
                'T2': 'Very good! üëè You\'re on the right track! Go to the booth for your ORANGE prize!',
                'T3': 'Excellent! üéâ You answered all correctly! Go to the booth for your GREEN prize!'
            };
            
            document.getElementById('tierMessage').textContent = messages[tier];
            
            // Afi»ôeazƒÉ sau ascunde butonul de revendicare √Æn func»õie de scor
            const claimSection = document.getElementById('claimPrizeSection');
            const retrySection = document.getElementById('retrySection');
            
            if (score === 0) {
                // Scor 0 - permite reluare
                claimSection.style.display = 'none';
                retrySection.style.display = 'block';
            } else {
                // Scor > 0 - afi»ôeazƒÉ buton revendicare
                claimSection.style.display = 'block';
                retrySection.style.display = 'none';
            }
        }
        
        // ============================================
        // BACKEND INTEGRATION
        // ============================================
        
        function submitToBackend(score, duration) {
            const token = document.getElementById('tokenInput').value.trim();
            
            const payload = {
                token: token || null,
                answers: userAnswers,
                score: score,
                ts: new Date().toISOString(),
                duration: duration
            };
            
            fetch(CONFIG.BACKEND_URL, {
                method: 'POST',
                mode: 'no-cors', // Apps Script cere no-cors
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            }).catch(err => {
                console.log('Backend submission error (expected with no-cors):', err);
            });
        }
    </script>
</body>
</html>
