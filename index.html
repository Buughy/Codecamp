<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeCamp Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
            padding: 40px;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .visma-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #ED1B2F;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .visma-logo {
            height: 150px;
            width: auto;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }
        
        .codecamp-badge {
            font-size: 0.9em;
            color: #666;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        h1 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            color: #6b7280;
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 500;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.2s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }
        
        .btn-primary {
            background: #ED1B2F;
            color: white;
        }
        
        .btn-primary:hover {
            background: #D91828;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(237, 27, 47, 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .question-counter {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .question-text {
            color: #1f2937;
            font-size: 1.2em;
            margin-bottom: 20px;
            line-height: 1.5;
            font-weight: 500;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .option {
            padding: 14px 18px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            text-align: left;
        }
        
        .option:hover {
            border-color: #667eea;
            background: #f9fafb;
        }
        
        .option.selected {
            border-color: #ED1B2F;
            background: #FFE8EA;
        }
        
        .result-screen {
            text-align: center;
        }
        
        .score-display {
            font-size: 4em;
            font-weight: 700;
            margin: 20px 0;
        }
        
        .tier-badge {
            display: inline-block;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.8em;
            font-weight: 700;
            color: white;
            margin: 20px 0;
        }
        
        .tier-t1 {
            background: #EAB308; /* Galben - 1/3 */
        }
        
        .tier-t2 {
            background: #EA580C; /* Portocaliu - 2/3 */
        }
        
        .tier-t3 {
            background: #16A34A; /* Verde - 3/3 */
        }
        
        .tier-message {
            font-size: 1.2em;
            color: #374151;
            margin: 20px 0;
            line-height: 1.6;
        }
        
        .error-message {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .info-message {
            background: #dbeafe;
            color: #1e40af;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }
        
        .already-played {
            text-align: center;
            padding: 40px 20px;
        }
        
        .already-played h2 {
            color: #1f2937;
            margin-bottom: 15px;
        }
        
        .already-played p {
            color: #6b7280;
            line-height: 1.6;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 25px;
            }
            
            h1 {
                font-size: 1.6em;
            }
            
            .score-display {
                font-size: 3em;
            }
            
            .tier-badge {
                font-size: 1.4em;
                padding: 12px 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Visma Logo Header -->
        <div class="visma-header">
            <img src="Visma_logo.png" alt="Visma Logo" class="visma-logo">
            <div class="codecamp-badge">CodeCamp Quiz</div>
        </div>
        
        <!-- Start Screen -->
        <div id="startScreen" class="screen active">
            <h1>üöÄ Test Your Knowledge</h1>
            <p class="subtitle">3 programming questions to evaluate your skills!</p>
            
            <div class="input-group" id="tokenInputGroup" style="display: none;">
                <label for="tokenInput">Token (optional):</label>
                <input type="text" id="tokenInput" placeholder="Enter your unique token">
                <div class="info-message" style="margin-top: 10px;">
                    If you received a token, enter it above. Otherwise, you can continue without a token.
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="startQuiz()">Start Quiz</button>
        </div>
        
        <!-- Quiz Screen -->
        <div id="quizScreen" class="screen">
            <div class="question-counter" id="questionCounter"></div>
            <div class="question-text" id="questionText"></div>
            <div class="options" id="optionsContainer"></div>
            <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next</button>
        </div>
        
        <!-- Result Screen -->
        <div id="resultScreen" class="screen">
            <div class="result-screen">
                <h1>Your Result</h1>
                <div class="score-display" id="scoreDisplay"></div>
                <div id="tierBadge"></div>
                <div class="tier-message" id="tierMessage"></div>
                
                <!-- Claim prize section (for score > 0) -->
                <div id="claimPrizeSection" style="margin-top: 30px; padding: 20px; background: #FFE8EA; border-radius: 12px; border: 2px solid #ED1B2F;">
                    <p style="color: #991B1B; font-weight: 600; margin-bottom: 15px; font-size: 1.1em;">
                        ‚ö†Ô∏è Attention! This button must be pressed in the presence of booth staff to confirm prize claim.
                    </p>
                    <button class="btn btn-primary" onclick="claimPrize()" style="font-size: 1.2em; padding: 15px 40px; width: 100%;">
                        üéÅ Claim Prize
                    </button>
                </div>
                
                <!-- Retry section (for score = 0) -->
                <div id="retrySection" style="display: none; margin-top: 30px; padding: 20px; background: #FEE2E2; border-radius: 12px; border: 2px solid #ED1B2F;">
                    <p style="color: #991B1B; font-weight: 600; margin-bottom: 15px; font-size: 1.1em;">
                        Unfortunately you didn't answer any question correctly. You can try again!
                    </p>
                    <button class="btn" onclick="retryQuiz()" style="font-size: 1.2em; padding: 15px 40px; width: 100%; background: #ED1B2F; color: white;">
                        üîÑ Try Again
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Already Played Screen -->
        <div id="alreadyPlayedScreen" class="screen">
            <div class="already-played">
                <h2>‚úÖ You've Already Participated!</h2>
                <p>Thank you for participating! You can only play once to keep the competition fair.</p>
                
                <div id="previousResultContainer" style="margin: 30px 0;">
                    <h3 style="color: #374151; margin-bottom: 15px;">Your previous result:</h3>
                    <div class="score-display" id="previousScore" style="font-size: 3em;"></div>
                    <div id="previousTierBadge"></div>
                    <div class="tier-message" id="previousTierMessage" style="font-size: 1.1em;"></div>
                </div>
                
                <p style="margin-top: 20px; font-weight: 600; color: #1f2937;">Visit the booth to claim your prize!</p>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURARE
        // ============================================
        
        const CONFIG = {
            BACKEND_URL: null,
            NUM_QUESTIONS: 3,
            LOCAL_STORAGE_KEY: 'cc_quiz_played',
            SCORE_STORAGE_KEY: 'cc_quiz_score',
            TIER_STORAGE_KEY: 'cc_quiz_tier',
            IN_PROGRESS_KEY: 'cc_quiz_in_progress',
            USE_TOKENS: false
        };
        
        // ============================================
        // QUESTION BANK (30+ √ÆntrebƒÉri)
        // ============================================
        
        const questionBank = (() => {
            // Encoded questions for anti-cheat (40 harder questions: JS 20%, C# 25%, Java 20%, Python 15%, SQL 10%, General 10%)
            const e = "W3sicSI6ICJXaGF0IGlzIHRoZSBvdXRwdXQgb2YgYFsxLCAyLCAzXS5tYXAoeCA9PiB4ICogMikuZmlsdGVyKHggPT4geCA+IDMpYD8iLCAib3B0aW9ucyI6IFsiWzIsIDQsIDZdIiwgIls0LCA2XSIsICJbMiwgNl0iLCAiWzZdIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgYFByb21pc2UuYWxsKFtwMSwgcDIsIHAzXSlgIGRvIGlmIHAyIHJlamVjdHM/IiwgIm9wdGlvbnMiOiBbIlJldHVybnMgYWxsIHJlc29sdmVkIHByb21pc2VzIiwgIkltbWVkaWF0ZWx5IHJlamVjdHMgd2l0aCBwMidzIGVycm9yIiwgIldhaXRzIGZvciBhbGwgYW5kIHJldHVybnMgZXJyb3JzIiwgIklnbm9yZXMgcDIgYW5kIGNvbnRpbnVlcyJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBpcyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGBjYWxsKClgIGFuZCBgYXBwbHkoKWAgaW4gSmF2YVNjcmlwdD8iLCAib3B0aW9ucyI6IFsiTm8gZGlmZmVyZW5jZSIsICJgY2FsbCgpYCB0YWtlcyBhcmd1bWVudHMgaW5kaXZpZHVhbGx5LCBgYXBwbHkoKWAgdGFrZXMgYW4gYXJyYXkiLCAiYGFwcGx5KClgIGlzIGZhc3RlciIsICJgY2FsbCgpYCB3b3JrcyBvbmx5IHdpdGggZnVuY3Rpb25zIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgYE9iamVjdC5jcmVhdGUobnVsbClgIGNyZWF0ZT8iLCAib3B0aW9ucyI6IFsiQW4gZW1wdHkgb2JqZWN0IHdpdGggcHJvdG90eXBlIiwgIkFuIG9iamVjdCB3aXRob3V0IGFueSBwcm90b3R5cGUiLCAibnVsbCIsICJ1bmRlZmluZWQiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgaXMgdGhlIHJlc3VsdCBvZiBgdHlwZW9mIE5hTmA/IiwgIm9wdGlvbnMiOiBbIidOYU4nIiwgIid1bmRlZmluZWQnIiwgIidudW1iZXInIiwgIidvYmplY3QnIl0sICJjIjogMn0sIHsicSI6ICJXaGF0IGRvZXMgdGhlIGB5aWVsZGAga2V5d29yZCBkbyBpbiBKYXZhU2NyaXB0PyIsICJvcHRpb25zIjogWyJQYXVzZXMgYW5kIHJlc3VtZXMgZ2VuZXJhdG9yIGZ1bmN0aW9ucyIsICJTdG9wcyBleGVjdXRpb24gcGVybWFuZW50bHkiLCAiUmV0dXJucyBhIHByb21pc2UiLCAiQ3JlYXRlcyBhIG5ldyB0aHJlYWQiXSwgImMiOiAwfSwgeyJxIjogIldoYXQgaXMgYSBXZWFrTWFwIGluIEphdmFTY3JpcHQ/IiwgIm9wdGlvbnMiOiBbIkEgbWFwIHdpdGggd2VhayByZWZlcmVuY2VzIHRvIGtleXMiLCAiQSBtYXAgdGhhdCBkZWxldGVzIG9sZCBlbnRyaWVzIiwgIkEgcmVhZC1vbmx5IG1hcCIsICJBIG1hcCB3aXRoIGxpbWl0ZWQgc2l6ZSJdLCAiYyI6IDB9LCB7InEiOiAiV2hhdCBkb2VzIGAnNScgLSAzYCByZXR1cm4gaW4gSmF2YVNjcmlwdD8iLCAib3B0aW9ucyI6IFsiJzUzJyIsICIyIiwgIicyJyIsICJOYU4iXSwgImMiOiAxfSwgeyJxIjogIldoYXQgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBgcmVmYCBhbmQgYG91dGAgcGFyYW1ldGVycyBpbiBDIz8iLCAib3B0aW9ucyI6IFsiTm8gZGlmZmVyZW5jZSIsICJgcmVmYCBtdXN0IGJlIGluaXRpYWxpemVkIGJlZm9yZSBwYXNzaW5nLCBgb3V0YCBkb2Vzbid0IiwgImBvdXRgIGlzIGZhc3RlciIsICJgcmVmYCBvbmx5IHdvcmtzIHdpdGggdmFsdWUgdHlwZXMiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyB0aGUgYGFzeW5jYCBrZXl3b3JkIGRvIGluIEMjPyIsICJvcHRpb25zIjogWyJDcmVhdGVzIGEgbmV3IHRocmVhZCIsICJNYXJrcyBhIG1ldGhvZCB0aGF0IGNvbnRhaW5zIGF3YWl0IG9wZXJhdGlvbnMiLCAiTWFrZXMgY29kZSBydW4gZmFzdGVyIiwgIlByZXZlbnRzIGJsb2NraW5nIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGlzIHRoZSBwdXJwb3NlIG9mIGBJRGlzcG9zYWJsZWAgaW50ZXJmYWNlIGluIEMjPyIsICJvcHRpb25zIjogWyJUbyBkZWxldGUgb2JqZWN0cyIsICJUbyByZWxlYXNlIHVubWFuYWdlZCByZXNvdXJjZXMiLCAiVG8gc2VyaWFsaXplIG9iamVjdHMiLCAiVG8gY29tcGFyZSBvYmplY3RzIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGlzIGEgZGVsZWdhdGUgaW4gQyM/IiwgIm9wdGlvbnMiOiBbIkEgY2xhc3MgdGhhdCBpbmhlcml0cyBmcm9tIGFub3RoZXIiLCAiQSB0eXBlLXNhZmUgZnVuY3Rpb24gcG9pbnRlciIsICJBbiBpbnRlcmZhY2UgaW1wbGVtZW50YXRpb24iLCAiQSBzdGF0aWMgbWV0aG9kIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgYHNlYWxlZGAga2V5d29yZCBwcmV2ZW50IGluIEMjPyIsICJvcHRpb25zIjogWyJNZXRob2Qgb3ZlcnJpZGluZyIsICJDbGFzcyBpbmhlcml0YW5jZSIsICJJbnRlcmZhY2UgaW1wbGVtZW50YXRpb24iLCAiUHJvcGVydHkgYWNjZXNzIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGlzIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gYFN0cmluZ2AgYW5kIGBTdHJpbmdCdWlsZGVyYCBpbiBDIz8iLCAib3B0aW9ucyI6IFsiYFN0cmluZ2AgaXMgbXV0YWJsZSwgYFN0cmluZ0J1aWxkZXJgIGlzIGltbXV0YWJsZSIsICJgU3RyaW5nYCBpcyBpbW11dGFibGUsIGBTdHJpbmdCdWlsZGVyYCBpcyBtdXRhYmxlIiwgIk5vIGRpZmZlcmVuY2UiLCAiYFN0cmluZ0J1aWxkZXJgIGlzIHNsb3dlciJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBkb2VzIExJTlEgc3RhbmQgZm9yIGluIEMjPyIsICJvcHRpb25zIjogWyJMYW5ndWFnZSBJbnRlZ3JhdGVkIFF1ZXJ5IiwgIkxpbmVhciBRdWVyeSIsICJMaW5rIFF1ZXJ5IiwgIkxpc3QgSW50ZWdyYXRpb24gUXVlcnkiXSwgImMiOiAwfSwgeyJxIjogIldoYXQgaXMgYm94aW5nIGluIEMjPyIsICJvcHRpb25zIjogWyJDb252ZXJ0aW5nIHZhbHVlIHR5cGUgdG8gcmVmZXJlbmNlIHR5cGUiLCAiQ29udmVydGluZyByZWZlcmVuY2UgdHlwZSB0byB2YWx1ZSB0eXBlIiwgIkVuY3J5cHRpbmcgZGF0YSIsICJDb21wcmVzc2luZyBkYXRhIl0sICJjIjogMH0sIHsicSI6ICJXaGF0IGRvZXMgdGhlIGB2aXJ0dWFsYCBrZXl3b3JkIGFsbG93IGluIEMjPyIsICJvcHRpb25zIjogWyJNZXRob2Qgb3ZlcnJpZGluZyBpbiBkZXJpdmVkIGNsYXNzZXMiLCAiQ3JlYXRpbmcgYWJzdHJhY3QgbWV0aG9kcyIsICJQcmV2ZW50aW5nIGluaGVyaXRhbmNlIiwgIk1ha2luZyBmaWVsZHMgcHVibGljIl0sICJjIjogMH0sIHsicSI6ICJXaGF0IGlzIGEgbnVsbGFibGUgdHlwZSBpbiBDIz8iLCAib3B0aW9ucyI6IFsiQSB0eXBlIHRoYXQgY2FuIGJlIG51bGwgb3IgZW1wdHkiLCAiQSB2YWx1ZSB0eXBlIHRoYXQgY2FuIGJlIGFzc2lnbmVkIG51bGwiLCAiQSByZWZlcmVuY2UgdHlwZSIsICJBIHR5cGUgd2l0aG91dCB2YWx1ZSJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBpcyB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGA9PWAgYW5kIGAuZXF1YWxzKClgIGluIEphdmEgZm9yIFN0cmluZ3M/IiwgIm9wdGlvbnMiOiBbIk5vIGRpZmZlcmVuY2UiLCAiYD09YCBjb21wYXJlcyByZWZlcmVuY2VzLCBgLmVxdWFscygpYCBjb21wYXJlcyBjb250ZW50IiwgImAuZXF1YWxzKClgIGlzIGZhc3RlciIsICJgPT1gIGlzIGRlcHJlY2F0ZWQiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyB0aGUgYHZvbGF0aWxlYCBrZXl3b3JkIGRvIGluIEphdmE/IiwgIm9wdGlvbnMiOiBbIk1ha2VzIHZhcmlhYmxlIGNvbnN0YW50IiwgIkVuc3VyZXMgdmlzaWJpbGl0eSBhY3Jvc3MgdGhyZWFkcyIsICJQcmV2ZW50cyBpbmhlcml0YW5jZSIsICJJbmNyZWFzZXMgcGVyZm9ybWFuY2UiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgaXMgdGhlIHB1cnBvc2Ugb2YgYFN0cmVhbS5mbGF0TWFwKClgIGluIEphdmE/IiwgIm9wdGlvbnMiOiBbIkZsYXR0ZW5zIG5lc3RlZCBzdHJ1Y3R1cmVzIGludG8gc2luZ2xlIHN0cmVhbSIsICJNYXBzIGFuZCBmaWx0ZXJzIiwgIlNvcnRzIHN0cmVhbXMiLCAiQ291bnRzIGVsZW1lbnRzIl0sICJjIjogMH0sIHsicSI6ICJXaGF0IGlzIG1ldGhvZCBvdmVybG9hZGluZyBpbiBKYXZhPyIsICJvcHRpb25zIjogWyJSZWRlZmluaW5nIHBhcmVudCBtZXRob2QiLCAiTXVsdGlwbGUgbWV0aG9kcyB3aXRoIHNhbWUgbmFtZSwgZGlmZmVyZW50IHBhcmFtZXRlcnMiLCAiQ2FsbGluZyBwYXJlbnQgbWV0aG9kIiwgIkFic3RyYWN0IG1ldGhvZCBpbXBsZW1lbnRhdGlvbiJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBkb2VzIGBzeW5jaHJvbml6ZWRgIGtleXdvcmQgcHJldmVudCBpbiBKYXZhPyIsICJvcHRpb25zIjogWyJDb21waWxhdGlvbiBlcnJvcnMiLCAiUmFjZSBjb25kaXRpb25zIGluIG11bHRpLXRocmVhZGluZyIsICJNZW1vcnkgbGVha3MiLCAiU3RhY2sgb3ZlcmZsb3ciXSwgImMiOiAxfSwgeyJxIjogIldoYXQgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBgYWJzdHJhY3QgY2xhc3NgIGFuZCBgaW50ZXJmYWNlYCBpbiBKYXZhIDgrPyIsICJvcHRpb25zIjogWyJObyBkaWZmZXJlbmNlIiwgIkFic3RyYWN0IGNsYXNzIGNhbiBoYXZlIGNvbnN0cnVjdG9ycyBhbmQgc3RhdGUiLCAiSW50ZXJmYWNlIGlzIGZhc3RlciIsICJBYnN0cmFjdCBjbGFzcyBtdXN0IGJlIHB1YmxpYyJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBkb2VzIGBPcHRpb25hbC5vckVsc2VUaHJvdygpYCBkbyBpbiBKYXZhPyIsICJvcHRpb25zIjogWyJSZXR1cm5zIE9wdGlvbmFsIHZhbHVlIG9yIHRocm93cyBleGNlcHRpb24iLCAiQWx3YXlzIHRocm93cyBleGNlcHRpb24iLCAiUmV0dXJucyBudWxsIiwgIkNyZWF0ZXMgbmV3IE9wdGlvbmFsIl0sICJjIjogMH0sIHsicSI6ICJXaGF0IGlzIGEgbGFtYmRhIGV4cHJlc3Npb24gaW4gSmF2YT8iLCAib3B0aW9ucyI6IFsiQSBsb29wIHN0YXRlbWVudCIsICJBIGNvbmNpc2Ugd2F5IHRvIHJlcHJlc2VudCBhbm9ueW1vdXMgZnVuY3Rpb25zIiwgIkEgY2xhc3MgZGVmaW5pdGlvbiIsICJBIHZhcmlhYmxlIHR5cGUiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgaXMgYSBsaXN0IGNvbXByZWhlbnNpb24gaW4gUHl0aG9uPyIsICJvcHRpb25zIjogWyJBIHdheSB0byBkb2N1bWVudCBsaXN0cyIsICJDb25jaXNlIHdheSB0byBjcmVhdGUgbGlzdHMgZnJvbSBpdGVyYWJsZXMiLCAiQSBsaXN0IG1ldGhvZCIsICJBIGRlYnVnZ2luZyB0b29sIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgYCphcmdzYCBhbmQgYCoqa3dhcmdzYCBhbGxvdyBpbiBQeXRob24/IiwgIm9wdGlvbnMiOiBbIlZhcmlhYmxlIG51bWJlciBvZiBhcmd1bWVudHMiLCAiT25seSBrZXl3b3JkIGFyZ3VtZW50cyIsICJPbmx5IHBvc2l0aW9uYWwgYXJndW1lbnRzIiwgIkZ1bmN0aW9uIGRlY29yYXRvcnMiXSwgImMiOiAwfSwgeyJxIjogIldoYXQgaXMgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBgaXNgIGFuZCBgPT1gIGluIFB5dGhvbj8iLCAib3B0aW9ucyI6IFsiTm8gZGlmZmVyZW5jZSIsICJgaXNgIGNoZWNrcyBpZGVudGl0eSwgYD09YCBjaGVja3MgZXF1YWxpdHkiLCAiYGlzYCBpcyBmYXN0ZXIiLCAiYD09YCBpcyBkZXByZWNhdGVkIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgYEBzdGF0aWNtZXRob2RgIGRlY29yYXRvciBkbyBpbiBQeXRob24/IiwgIm9wdGlvbnMiOiBbIk1ha2VzIG1ldGhvZCBwcml2YXRlIiwgIkNyZWF0ZXMgbWV0aG9kIHRoYXQgZG9lc24ndCBuZWVkIGluc3RhbmNlIG9yIGNsYXNzIiwgIk1ha2VzIG1ldGhvZCBhYnN0cmFjdCIsICJQcmV2ZW50cyBvdmVycmlkaW5nIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGlzIGEgZ2VuZXJhdG9yIGluIFB5dGhvbj8iLCAib3B0aW9ucyI6IFsiQSBmdW5jdGlvbiB0aGF0IGNyZWF0ZXMgbGlzdHMiLCAiQSBmdW5jdGlvbiB0aGF0IHlpZWxkcyB2YWx1ZXMgbGF6aWx5IiwgIkEgY2xhc3MgY29uc3RydWN0b3IiLCAiQSBtb2R1bGUgaW1wb3J0ZXIiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyBgd2l0aGAgc3RhdGVtZW50IGVuc3VyZSBpbiBQeXRob24/IiwgIm9wdGlvbnMiOiBbIkZhc3RlciBleGVjdXRpb24iLCAiUHJvcGVyIHJlc291cmNlIGNsZWFudXAiLCAiVGhyZWFkIHNhZmV0eSIsICJUeXBlIGNoZWNraW5nIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGlzIHRoZSBwdXJwb3NlIG9mIGBHUk9VUCBCWWAgY2xhdXNlIGluIFNRTD8iLCAib3B0aW9ucyI6IFsiU29ydHMgcmVzdWx0cyIsICJHcm91cHMgcm93cyB3aXRoIHNhbWUgdmFsdWVzIGZvciBhZ2dyZWdhdGlvbiIsICJGaWx0ZXJzIHJvd3MiLCAiSm9pbnMgdGFibGVzIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgYSBgTEVGVCBKT0lOYCByZXR1cm4/IiwgIm9wdGlvbnMiOiBbIk9ubHkgbWF0Y2hpbmcgcm93cyIsICJBbGwgbGVmdCB0YWJsZSByb3dzIGFuZCBtYXRjaGluZyByaWdodCByb3dzIiwgIkFsbCByaWdodCB0YWJsZSByb3dzIiwgIk5vIGR1cGxpY2F0ZXMiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgaXMgYSBzdG9yZWQgcHJvY2VkdXJlIGluIFNRTD8iLCAib3B0aW9ucyI6IFsiQSBzYXZlZCBxdWVyeSByZXN1bHQiLCAiUHJlY29tcGlsZWQgU1FMIGNvZGUgdGhhdCBjYW4gYmUgcmV1c2VkIiwgIkEgdGFibGUgYmFja3VwIiwgIkFuIGluZGV4IHR5cGUiXSwgImMiOiAxfSwgeyJxIjogIldoYXQgZG9lcyBgSEFWSU5HYCBjbGF1c2UgZmlsdGVyIGluIFNRTD8iLCAib3B0aW9ucyI6IFsiSW5kaXZpZHVhbCByb3dzIGJlZm9yZSBncm91cGluZyIsICJHcm91cGVkIHJlc3VsdHMgYWZ0ZXIgYWdncmVnYXRpb24iLCAiVGFibGUgbmFtZXMiLCAiQ29sdW1uIHR5cGVzIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGlzIHRoZSB0aW1lIGNvbXBsZXhpdHkgb2YgYmluYXJ5IHNlYXJjaD8iLCAib3B0aW9ucyI6IFsiTyhuKSIsICJPKGxvZyBuKSIsICJPKG7CsikiLCAiTygxKSJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBkZXNpZ24gcGF0dGVybiBlbnN1cmVzIG9ubHkgb25lIGluc3RhbmNlIG9mIGEgY2xhc3MgZXhpc3RzPyIsICJvcHRpb25zIjogWyJGYWN0b3J5IiwgIlNpbmdsZXRvbiIsICJPYnNlcnZlciIsICJTdHJhdGVneSJdLCAiYyI6IDF9LCB7InEiOiAiV2hhdCBpcyB0aGUgbWFpbiBwcmluY2lwbGUgb2YgUkVTVCBBUEk/IiwgIm9wdGlvbnMiOiBbIlVzZXMgb25seSBHRVQgcmVxdWVzdHMiLCAiU3RhdGVsZXNzIGNsaWVudC1zZXJ2ZXIgY29tbXVuaWNhdGlvbiIsICJBbHdheXMgcmV0dXJucyBKU09OIiwgIlJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uIl0sICJjIjogMX0sIHsicSI6ICJXaGF0IGRvZXMgQ0kvQ0Qgc3RhbmQgZm9yPyIsICJvcHRpb25zIjogWyJDb2RlIEludGVncmF0aW9uL0NvZGUgRGVsaXZlcnkiLCAiQ29udGludW91cyBJbnRlZ3JhdGlvbi9Db250aW51b3VzIERlcGxveW1lbnQiLCAiQ2VudHJhbCBJbnRlZ3JhdGlvbi9DZW50cmFsIERlcGxveW1lbnQiLCAiQ29kZSBJbnNwZWN0aW9uL0NvZGUgRGVidWciXSwgImMiOiAxfV0=";
            const k = [1, 1, 1, 1, 2, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1];
            try {
                // Fix UTF-8 decoding dupƒÉ atob()
                const base64Decoded = atob(e);
                const utf8Decoded = decodeURIComponent(Array.from(base64Decoded).map(c => 
                    '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)
                ).join(''));
                const p = JSON.parse(utf8Decoded);
                return p.map((q, i) => ({q: q.q, options: q.options, correct: k[i]}));
            } catch(err) {
                console.error('Decode error:', err);
                return [];
            }
        })();
        
        // ============================================
        // STATE
        // ============================================
        
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let selectedOption = null;
        let startTime = null;
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        window.onload = function() {
            // VerificƒÉ dacƒÉ a revendicat deja premiul
            if (localStorage.getItem(CONFIG.LOCAL_STORAGE_KEY)) {
                showAlreadyPlayedScreen();
                return;
            }
            
            // VerificƒÉ dacƒÉ a terminat quiz-ul dar nu a revendicat √ÆncƒÉ
            const savedScore = localStorage.getItem(CONFIG.SCORE_STORAGE_KEY);
            const savedTier = localStorage.getItem(CONFIG.TIER_STORAGE_KEY);
            
            if (savedScore !== null && savedTier !== null) {
                const score = parseInt(savedScore);
                
                // DacƒÉ scorul = 0, »ôterge rezultatul »ôi permite reluare
                if (score === 0) {
                    localStorage.removeItem(CONFIG.SCORE_STORAGE_KEY);
                    localStorage.removeItem(CONFIG.TIER_STORAGE_KEY);
                    clearQuizProgress();
                } else {
                    // Are scor > 0, trebuie sƒÉ meargƒÉ la ecranul de revendicare
                    displayResults(score, savedTier);
                    return;
                }
            }
            
            // VerificƒÉ dacƒÉ are quiz √Æn progres - continuƒÉ de unde a rƒÉmas
            if (localStorage.getItem(CONFIG.IN_PROGRESS_KEY)) {
                const savedState = JSON.parse(localStorage.getItem(CONFIG.IN_PROGRESS_KEY));
                currentQuestions = savedState.questions;
                currentQuestionIndex = savedState.currentIndex;
                userAnswers = savedState.answers;
                startTime = savedState.startTime;
                showScreen('quizScreen');
                displayQuestion();
                return;
            }
            
            if (CONFIG.USE_TOKENS) {
                document.getElementById('tokenInputGroup').style.display = 'block';
            }
        };
        
        function saveQuizProgress() {
            const state = {
                questions: currentQuestions,
                currentIndex: currentQuestionIndex,
                answers: userAnswers,
                startTime: startTime
            };
            localStorage.setItem(CONFIG.IN_PROGRESS_KEY, JSON.stringify(state));
        }
        
        function clearQuizProgress() {
            localStorage.removeItem(CONFIG.IN_PROGRESS_KEY);
        }
        
        function retryQuiz() {
            // »òterge toate datele salvate
            localStorage.removeItem(CONFIG.SCORE_STORAGE_KEY);
            localStorage.removeItem(CONFIG.TIER_STORAGE_KEY);
            clearQuizProgress();
            
            // ReseteazƒÉ variabilele
            currentQuestions = [];
            currentQuestionIndex = 0;
            userAnswers = [];
            selectedOption = null;
            
            // Re√Æncepe de la ecranul de start
            showScreen('startScreen');
        }
        
        function claimPrize() {
            // Confirmation dialog to ensure staff is present
            const confirmed = confirm(
                "‚ö†Ô∏è IMPORTANT!\n\n" +
                "Are you with a Visma booth staff member right now?\n\n" +
                "You can only claim your prize ONCE and it must be done in the presence of booth staff.\n\n" +
                "Click OK only if a staff member is present."
            );
            
            if (!confirmed) {
                return; // User cancelled - don't claim
            }
            
            // Mark as claimed
            localStorage.setItem(CONFIG.LOCAL_STORAGE_KEY, '1');
            // Clear saved progress
            clearQuizProgress();
            // Show "already participated" screen with result
            showAlreadyPlayedScreen();
        }
        
        function showAlreadyPlayedScreen() {
            const previousScore = localStorage.getItem(CONFIG.SCORE_STORAGE_KEY);
            const previousTier = localStorage.getItem(CONFIG.TIER_STORAGE_KEY);
            
            if (previousScore && previousTier) {
                document.getElementById('previousScore').textContent = `${previousScore}/${CONFIG.NUM_QUESTIONS}`;
                const tierBadge = document.getElementById('previousTierBadge');
                tierBadge.innerHTML = `<div class="tier-badge tier-${previousTier.toLowerCase()}">${previousTier}</div>`;
                const messages = {
                    'T1': 'üåü Good start! Your YELLOW prize!',
                    'T2': 'üëè Very good! Your ORANGE prize!',
                    'T3': 'üèÜ Excellent! Your GREEN prize!'
                };
                document.getElementById('previousTierMessage').textContent = messages[previousTier];
            } else {
                document.getElementById('previousResultContainer').style.display = 'none';
            }
            showScreen('alreadyPlayedScreen');
        }
        
        // ============================================
        // NAVIGATION
        // ============================================
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        // ============================================
        // QUIZ LOGIC
        // ============================================
        
        function startQuiz() {
            startTime = Date.now();
            
            // RandomizeazƒÉ »ôi selecteazƒÉ √ÆntrebƒÉri
            const shuffled = [...questionBank].sort(() => Math.random() - 0.5);
            currentQuestions = shuffled.slice(0, CONFIG.NUM_QUESTIONS);
            
            currentQuestionIndex = 0;
            userAnswers = [];
            
            // SalveazƒÉ starea - quiz-ul a √Ænceput!
            saveQuizProgress();
            
            showScreen('quizScreen');
            displayQuestion();
        }
        
        function displayQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            
            document.getElementById('questionCounter').textContent = 
                `Question ${currentQuestionIndex + 1} of ${CONFIG.NUM_QUESTIONS}`;
            
            document.getElementById('questionText').textContent = question.q;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });
            
            selectedOption = null;
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('nextBtn').textContent = 
                currentQuestionIndex === CONFIG.NUM_QUESTIONS - 1 ? 'Finish' : 'Next';
        }
        
        function selectOption(index) {
            selectedOption = index;
            
            document.querySelectorAll('.option').forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });
            
            document.getElementById('nextBtn').disabled = false;
        }
        
        function nextQuestion() {
            // Prevent advancing without selecting an answer
            if (selectedOption === null || selectedOption === undefined) return;
            
            userAnswers.push(selectedOption);
            
            if (currentQuestionIndex < CONFIG.NUM_QUESTIONS - 1) {
                currentQuestionIndex++;
                saveQuizProgress(); // Save progress after each answer
                displayQuestion();
            } else {
                finishQuiz();
            }
        }
        
        // ============================================
        // RESULTS
        // ============================================
        
        function finishQuiz() {
            const score = calculateScore();
            const tier = getTier(score);
            const duration = Math.round((Date.now() - startTime) / 1000);
            
            // SalveazƒÉ doar rezultatul (NU marcheazƒÉ ca revendicat √ÆncƒÉ)
            localStorage.setItem(CONFIG.SCORE_STORAGE_KEY, score);
            localStorage.setItem(CONFIG.TIER_STORAGE_KEY, tier);
            
            // Quiz-ul s-a terminat - nu mai e nevoie sƒÉ salvƒÉm progresul
            clearQuizProgress();
            
            if (CONFIG.BACKEND_URL) {
                submitToBackend(score, duration);
            }
            
            displayResults(score, tier);
        }
        
        function calculateScore() {
            let correct = 0;
            currentQuestions.forEach((q, i) => {
                console.log(`Q${i+1}: User answered ${userAnswers[i]}, Correct is ${q.correct}, Match: ${userAnswers[i] === q.correct}`);
                if (userAnswers[i] === q.correct) {
                    correct++;
                }
            });
            console.log(`Total correct: ${correct}/${currentQuestions.length}`);
            return correct;
        }
        
        function getTier(score) {
            if (score === 0) return null;  // 0/3 = No tier
            if (score === 1) return 'T1';  // 1/3 = T1 Yellow
            if (score === 2) return 'T2';  // 2/3 = T2 Orange
            return 'T3';                   // 3/3 = T3 Green
        }
        
        function displayResults(score, tier) {
            showScreen('resultScreen');
            
            document.getElementById('scoreDisplay').textContent = `${score}/${CONFIG.NUM_QUESTIONS}`;
            
            const tierBadge = document.getElementById('tierBadge');
            const tierMessage = document.getElementById('tierMessage');
            
            if (score === 0) {
                // No tier badge for 0 score
                tierBadge.innerHTML = '';
                tierMessage.textContent = '';
            } else {
                tierBadge.innerHTML = `<div class="tier-badge tier-${tier.toLowerCase()}">${tier}</div>`;
                
                const messages = {
                    'T1': 'Good start! üåü Keep learning! Go to the booth for your YELLOW prize!',
                    'T2': 'Very good! üëè You\'re on the right track! Go to the booth for your ORANGE prize!',
                    'T3': 'Excellent! üéâ You answered all correctly! Go to the booth for your GREEN prize!'
                };
                
                tierMessage.textContent = messages[tier];
            }
            
            // Afi»ôeazƒÉ sau ascunde butonul de revendicare √Æn func»õie de scor
            const claimSection = document.getElementById('claimPrizeSection');
            const retrySection = document.getElementById('retrySection');
            
            if (score === 0) {
                // Scor 0 - permite reluare
                claimSection.style.display = 'none';
                retrySection.style.display = 'block';
            } else {
                // Scor > 0 - afi»ôeazƒÉ buton revendicare
                claimSection.style.display = 'block';
                retrySection.style.display = 'none';
            }
        }
        
        // ============================================
        // BACKEND INTEGRATION
        // ============================================
        
        function submitToBackend(score, duration) {
            const token = document.getElementById('tokenInput').value.trim();
            
            const payload = {
                token: token || null,
                answers: userAnswers,
                score: score,
                ts: new Date().toISOString(),
                duration: duration
            };
            
            fetch(CONFIG.BACKEND_URL, {
                method: 'POST',
                mode: 'no-cors', // Apps Script cere no-cors
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            }).catch(err => {
                console.log('Backend submission error (expected with no-cors):', err);
            });
        }
    </script>
</body>
</html>
